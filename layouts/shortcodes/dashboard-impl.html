<table id="dashboard-impls" class="sort Dashboard">
    <thead>
        <tr>
            <th>Implementation</th>
            <th>CI</th>
            <th>Test Coverage</th>
            <th>Security Audit</th>
        </tr>
    </thead>
    <tbody>
        {{- template "dashboard-impls-children" (dict "Section" ($.Site.GetPage "implementations") ) -}}
    </tbody>
</table>

<!-- Children Template -->
{{ define "dashboard-impls-children" }}
    {{- $pages := where .Section.Pages "Params.bookhidden" "ne" true -}}
    {{- range sort $pages "Weight" "asc" -}}
        {{ $parts := split .Params.implRepo "/" }}
        {{ $size := len $parts }}
        {{ $path := delimit (slice (index $parts (sub $size 2)) (index $parts (sub $size 1))) "/" }}
        {{ $url := printf "https://codecov.io/api/gh/%s" $path }}
        {{ $data := getJSON $url }}
        {{ $cov := $data.commit.totals.c }}
        {{ $color := "bg-na"}}
        {{ if gt $cov 0 }}
            {{ $color = "bg-incorrect"}}
        {{ end }}
        {{ if gt $cov 20 }}
            {{ $color = "bg-wip"}}
        {{ end }}
        {{ if gt $cov 45 }}
            {{ $color = "bg-incomplete"}}
        {{ end }}
        {{ if gt $cov 70 }}
            {{ $color = "bg-stable"}}
        {{ end }}
        <tr>
            <td><a title="{{.Title}}" href="{{.Permalink}}">{{.Title}}</a></td>
            <td class="text-black {{ if eq $data.commit.ci_passed  true }}bg-stable{{ else if eq $data.commit.ci_passed false }}bg-incorrect {{ else }}bg-na{{end}}">
                {{ if eq $data.commit.ci_passed  true }}Passed{{ else if eq $data.commit.ci_passed false }}Failed{{ else }}Unknown{{ end }}
            </td>
            <td class="text-black {{ $color }}">
                <a class="text-black" href="https://codecov.io/gh/{{ $path }}" title="Open on codecov.io">
                    {{ if $data.commit.totals.c }}{{ math.Round $data.commit.totals.c }}%{{ else }}N/A{{end}}
                </a>
            </td>
            <td class="text-transparent {{ if gt .Page.Params.implAudit 0 }}bg-stable{{ else }}bg-incorrect{{end}}">
                {{ .Page.Params.implAudit }}
            </td>
        </tr>
        
    {{ end }}
{{ end }}