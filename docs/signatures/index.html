<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Signatures
  
 | Filecoin Spec</title>



<link rel="stylesheet" href="../../book.min.23e4d1e3709b51090814a78569072de166323089d7e859dbabb823c874bdc20d.css">


<link rel="icon" href="../../favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <link rel="stylesheet" href="../../css/syntax.css">
<link href="../../mermaid/mermaid.css" type="text/css" rel="stylesheet" />
<script src="../../mermaid/mermaid.js"></script>

</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="https://filecoin-project.github.io/specs/">Filecoin Spec</a>
</h2>



    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2fsignatures\2f "] {
      color: #0b3a53;
  }
  </style>

<p><a href="../../"><strong>Overview</strong></a></p>

<p><strong>Core</strong></p>

<ul>
<li><a href="../../docs/data-structures/">Data Structures</a></li>
<li>Cryptography

<ul>
<li><a href="../../docs/address/">Address</a></li>
<li><a href="../../docs/signatures/">Signatures</a></li>
<li><a href="../../docs/proofs/">Proofs</a></li>
<li><a href="../../docs/validation/">Block Validation</a></li>
</ul></li>
<li><a href="../../docs/networking/">Network</a>

<ul>
<li><a href="../../docs/data-propagation/">Data Propagation</a></li>
<li><a href="../../docs/network-protocols/">Specific Protocols</a></li>
</ul></li>
<li><a href="../../docs/expected-consensus/">Expected Consensus</a></li>
<li><a href="../../docs/state-machine/">State Machine</a>

<ul>
<li><a href="../../docs/local-storage/">Local Storage</a></li>
</ul></li>
</ul>

<p><a href="../../docs/actors/"><strong>Actors</strong></a></p>

<ul>
<li><a href="../../docs/mining/">Mining</a></li>
<li><a href="../../docs/storage-market/">Storage Market</a></li>
<li><a href="../../docs/retrieval-market/">Retrieval Market</a></li>
<li><a href="../../docs/payments/">Payments</a></li>
<li><a href="../../docs/faults/">Faults</a></li>
</ul>

<p><strong>Proofs</strong></p>

<ul>
<li><a href="../../docs/zigzag-circuit/">ZigZag</a></li>
</ul>

<p><a href="../../docs/definitions/"><strong>Glossary</strong></a></p>

<p><strong>Spec</strong></p>

<ul>
<li><a href="../../docs/style/">Style</a></li>
<li><a href="../../docs/process/">Process</a></li>
</ul>





</nav>


  
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="../../svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Signatures
  
</strong>
</header>

      
<article class="markdown">
  

<h1 id="signatures">Signatures</h1>

<h2 id="what-are-signatures-in-filecoin">What are signatures in Filecoin</h2>

<p>Signatures are cryptographic functions that attest to the origin of a particular message. In the context of Filecoin, signatures are used to send and receive messages among with the assurance that each message was generated by specific individuals. In other words, it is infeasible for another individual i to generate a signed message that appears to have been generated by j.</p>

<p>We use signatures in filecoin to verify <em>something</em> was done by <em>someone</em>. For example, we use signatures in order to validate deal messages which represent an action like a storage deals We also use signatures to determine who generated a particular message, determine public keys&ndash;which can be recovered from signed data and a signature, and find filecoin addresses which generated from a public key.</p>

<ul>
<li>Messages (From users to the blockchain)</li>
<li>Tickets (Signature of proof - <a href="../mining">Mining</a>)</li>
<li>Block signature (Signature over all data in the block - done by block leader)</li>
</ul>

<h1 id="interface">Interface</h1>

<p>Filecoin requires a system that fulfils the following interface to function correctly.</p>

<p>Note: <code>Message</code> is used here as the object being signed, but this interface should also work for other things that need to be signed.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Signature</span> <span class="kd">interface</span> <span class="p">{</span>

    <span class="c1">// Sign generates a proof that miner `M` generate message `m`
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// Out:
</span><span class="c1"></span>    <span class="c1">//    sig - a series of bytes representing a signature usually `r`|`s`
</span><span class="c1"></span>    <span class="c1">//    err - a standard error message indicating any process issues
</span><span class="c1"></span>    <span class="c1">// In:
</span><span class="c1"></span>    <span class="c1">//    m - a series of bytes representing a message to be signed
</span><span class="c1"></span>    <span class="c1">//    sk - a private key which cryptographically links `M` to `sig`
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="nf">Sign</span><span class="p">(</span><span class="nx">m</span> <span class="nx">Message</span><span class="p">,</span> <span class="nx">sk</span> <span class="nx">PrivateKey</span><span class="p">)</span> <span class="p">(</span><span class="nx">sig</span> <span class="nx">SignatureBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

    <span class="c1">// Verify validates the statement: only `M` could have generated `sig`
</span><span class="c1"></span>    <span class="c1">// given the validator has a message `m`, a signature `sig`, and a
</span><span class="c1"></span>    <span class="c1">// public key `pk`.
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// Out:
</span><span class="c1"></span>    <span class="c1">//    valid - a boolean value indicating the signature is valid
</span><span class="c1"></span>    <span class="c1">//    err - a standard error message indicating any process issues
</span><span class="c1"></span>    <span class="c1">// In:
</span><span class="c1"></span>    <span class="c1">//    m - a series of bytes representing the signed message
</span><span class="c1"></span>    <span class="c1">//    pk - the public key belonging to the signer `M`
</span><span class="c1"></span>    <span class="c1">//    sig - a series of bytes representing a signature usually `r`|`s`
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="nf">Verify</span><span class="p">(</span><span class="nx">m</span> <span class="nx">Messgage</span><span class="p">,</span> <span class="nx">pk</span> <span class="nx">PublicKey</span><span class="p">,</span> <span class="nx">sig</span> <span class="nx">SignatureBytes</span><span class="p">)</span> <span class="p">(</span><span class="nx">valid</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

    <span class="c1">// Recover, as its name implies, recovers a public key associated with a
</span><span class="c1"></span>    <span class="c1">// particular signature. In the case of ECDSA signatures, this function can
</span><span class="c1"></span>    <span class="c1">// be fulfilled via the &#39;ECRecover&#39; method. If a different signature scheme
</span><span class="c1"></span>    <span class="c1">// is used, then some other mechanism of &#39;recovering&#39; a message authors
</span><span class="c1"></span>    <span class="c1">// public key must be provided.
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// Out:
</span><span class="c1"></span>    <span class="c1">//    pk - the public key associated with `M` who signed `m`
</span><span class="c1"></span>    <span class="c1">//    err - a standard error message indicating any process issues
</span><span class="c1"></span>    <span class="c1">//    **
</span><span class="c1"></span>    <span class="c1">// In:
</span><span class="c1"></span>    <span class="c1">//    m - a series of bytes representing the signed message
</span><span class="c1"></span>    <span class="c1">//    sig - a series of bytes representing a signature usually `r`|`s`
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="nf">Recover</span><span class="p">(</span><span class="nx">m</span> <span class="nx">Message</span><span class="p">,</span> <span class="nx">sig</span> <span class="nx">SignatureBytes</span><span class="p">)</span> <span class="p">(</span><span class="nx">pk</span> <span class="nx">PublicKey</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>
<h1 id="secp256k1-signatures">Secp256k1 Signatures</h1>

<p>Currently, Filecoin uses secp256k1 signatures to fulfill the above interface. All signatures on messages, blocks, and tickets currently use the same scheme and format.</p>

<h2 id="signing-messages">Signing Messages</h2>

<p>To generate a signature for the <a href="data-structures.md#message"><code>Message</code></a> type, first serialize it, then hash the serialized bytes with blake2b-256. Then, take the 32 byte digest output the hash and compute the secp256k1 signature over it.</p>

<h3 id="wire-format">Wire Format</h3>

<p>We use standard secp256k1 signature serialization, as described below. For more details on how the Filecoin <code>Signature</code> type is serialized, see the relevant section in <a href="data-structures.md#signature">the data structures spec</a></p>

<p><strong>Signature</strong></p>

<pre><code>SignatureBytes = [0x30][len][0x02][r][indicator][s][indicator][recovery]
</code></pre>

<p><code>s</code> = Scalar of size 32 bytes</p>

<p><code>r</code> = Compressed elliptic curve point (x-coordinate) of size 32 bytes</p>

<p><code>recovery</code> = Information needed to recover a public key from <code>sig</code>.</p>

<ul>
<li>LSB(0) = parity of y-coordinate of r</li>
<li>LSB(1) = overflow indicator</li>
</ul>

<p><code>indicator</code> = a 2 byte formatting indicator</p>

<h3 id="external-references">External References</h3>

<ul>
<li>Elliptic Curve Cryptography Paper

<ul>
<li><a href="http://www.secg.org/sec1-v2.pdf">http://www.secg.org/sec1-v2.pdf</a></li>
</ul></li>
</ul>

</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    
    <a href="https://github.com/filecoin-project/specs/commit/9dcf16da57ae5577304bbf442808d35563add0aa" title='Last modified May 11, 2019 by dignifiedquire' target="_blank" rel="noopener">
      <img src="../../svg/code-merge.svg" alt="Changed" /> May 11, 2019
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/filecoin-project/specs/edit/master/signatures.md" target="_blank" rel="noopener">
      <img src="../../svg/code-fork.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#signatures">Signatures</a>
<ul>
<li><a href="#what-are-signatures-in-filecoin">What are signatures in Filecoin</a></li>
</ul></li>
<li><a href="#interface">Interface</a></li>
<li><a href="#secp256k1-signatures">Secp256k1 Signatures</a>
<ul>
<li><a href="#signing-messages">Signing Messages</a>
<ul>
<li><a href="#wire-format">Wire Format</a></li>
<li><a href="#external-references">External References</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
